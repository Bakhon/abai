<template>
    <div class="page-wrapper h-100">

        <div class="page-container row">
            <div class="col-12 mt-3 header">
                <transition name="bounce">
                    <div v-if="isTypeTimerActive" class="img-play"></div>
                </transition>
                <transition name="bounce">
                    <div v-if="!isTypeTimerActive" class="img-pause"></div>
                </transition>
                <div class="header-title">
                    {{headerTitle}}
                </div>
                <transition name="fade" mode="out-in">
                    <div v-if="isOpecActive" class="title-opec ml-2">
                        ОПЕК+
                    </div>
                </transition>
                <div class="img-download" @click="exportToExcel()"></div>
            </div>
            <div class="col-12 mt-3" @click="switchTimers()">
                <div class="reason-box" id="decreaseReason">{{decreaseReason}}</div>
                <table class="main-table col-12">
                    <tr>
                        <th rowspan="2">№ п/п</th>
                        <th rowspan="2">Предприятия</th>
                        <th rowspan="2">
                            План на {{currentYear}} г.
                        </th>
                        <th :class="!isOpecActive ? '' : 'hide-block'" rowspan="2">
                            План на {{currentMonthName}} месяц
                        </th>
                        <th :class="isOpecActive ? '' : 'hide-block'" rowspan="2">
                            План на {{currentMonthName}} месяц <br>
                            с учетом ОПЕК+
                        </th>
                        <th colspan="3" class="background-delimeters">СУТОЧНАЯ</th> <!-- >суточная <-->
                        <th colspan="3" class="background-delimeters">С НАЧАЛА МЕСЯЦА</th> <!-- >с начала месяца <-->
                        <th colspan="3" class="background-delimeters">С НАЧАЛА ГОДА</th> <!-- >с начала года <-->
                    </tr>
                    <tr>
                        <th :class="!isOpecActive ? '' : 'hide-block'">План</th>
                        <th :class="isOpecActive ? '' : 'hide-block'">
                            План<br>
                            с учетом ОПЕК+
                        </th>
                        <th>Факт</th>
                        <th :class="!isOpecActive ? '' : 'hide-block'">(+,-)</th>
                        <th :class="isOpecActive ? '' : 'hide-block'">
                            (+,-)<br>
                            с учетом ОПЕК+
                        </th>
                        <th :class="!isOpecActive ? '' : 'hide-block'">План</th>
                        <th :class="isOpecActive ? '' : 'hide-block'">
                            План<br>
                            с учетом ОПЕК+
                        </th>
                        <th>Факт</th>
                        <th :class="!isOpecActive ? '' : 'hide-block'">(+,-)</th>
                        <th :class="isOpecActive ? '' : 'hide-block'">
                            (+,-)<br>
                            с учетом ОПЕК+
                        </th>
                        <th :class="!isOpecActive ? '' : 'hide-block'">План</th>
                        <th :class="isOpecActive ? '' : 'hide-block'">
                            План<br>
                            с учетом ОПЕК+
                        </th>
                        <th>Факт</th>
                        <th :class="!isOpecActive ? '' : 'hide-block'">(+,-)</th>
                        <th :class="isOpecActive ? '' : 'hide-block'">
                            (+,-)<br>
                            с учетом ОПЕК+
                        </th>
                    </tr>
                    <tr
                            v-for="(item,index) in tableOutput.participationByKMG"
                            class="background-dark special"
                    >
                        <td>{{item.number}}</td>
                        <td :class="index === 1 ? 'summary-header_text-align' : ''">{{item.dzo}}</td>
                        <td >{{getFormattedNumber(item.yearlyPlan)}}</td>
                        <td v-if="!isOpecActive">{{getFormattedNumber(item.monthlyPlan)}}</td>
                        <td v-else>{{getFormattedNumber(item.monthlyPlanOpec)}}</td>
                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByDay)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByDay)}}</td>
                        <td>{{getFormattedNumber(item.factByDay)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByDay)"
                        >
                            {{getFormattedNumber(item.differenceByDay)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByDay)"
                        >
                            {{getFormattedNumber(item.differenceOpecByDay)}}
                        </td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByMonth)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByMonth)}}</td>
                        <td>{{getFormattedNumber(item.factByMonth)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByMonth)"
                        >
                            {{getFormattedNumber(item.differenceByMonth)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByMonth)"
                        >
                            {{getFormattedNumber(item.differenceOpecByMonth)}}
                        </td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByYear)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByYear)}}</td>
                        <td>{{getFormattedNumber(item.factByYear)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByYear)"
                        >
                            {{getFormattedNumber(item.differenceByYear)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByYear)"
                        >
                            {{getFormattedNumber(item.differenceOpecByYear)}}
                        </td>
                    </tr>
                    <tr
                            v-for="(item, index) in tableOutput.participationByDzo"
                            :class="getRowClass(index)"
                    >
                        <td v-if="index !== 1">{{item.number}}</td>
                        <td v-else></td>
                        <td :class="[1,13,14,15].includes(index) ? 'troubled-companies-padding' : ''">
                            {{companiesNameMapping.withParticipation[item.dzo]}}
                        </td>
                        <td>{{getFormattedNumber(item.yearlyPlan)}}</td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.monthlyPlan)}}</td>
                        <td v-else>{{getFormattedNumber(item.monthlyPlanOpec)}}</td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByDay)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByDay)}}</td>
                        <td>{{getFormattedNumber(item.factByDay)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByDay)"
                                @mouseover="mouseOver($event,item.reason)"
                                @mouseleave="mouseLeave"
                        >
                            {{getFormattedNumber(item.differenceByDay)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByDay)"
                        >
                            {{getFormattedNumber(item.differenceOpecByDay)}}
                        </td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByMonth)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByMonth)}}</td>
                        <td>{{getFormattedNumber(item.factByMonth)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByMonth)"
                        >
                            {{getFormattedNumber(item.differenceByMonth)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByMonth)"
                        >
                            {{getFormattedNumber(item.differenceOpecByMonth)}}
                        </td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByYear)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByYear)}}</td>
                        <td>{{getFormattedNumber(item.factByYear)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByYear)"
                        >
                            {{getFormattedNumber(item.differenceByYear)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByYear)"
                        >
                            {{getFormattedNumber(item.differenceOpecByYear)}}
                        </td>
                    </tr>
                    <tr class="empty-row">
                        <td></td>
                    </tr>
                    <tr
                            v-for="(item,index) in tableOutput.byKMG"
                            :class="index > 0 ? 'background-dark hide-block' :'background-dark special'"
                    >
                        <td>{{item.number}}</td>
                        <td>{{item.dzo}}</td>
                        <td >{{getFormattedNumber(item.yearlyPlan)}}</td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.monthlyPlan)}}</td>
                        <td v-else>{{getFormattedNumber(item.monthlyPlanOpec)}}</td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByDay)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByDay)}}</td>
                        <td>{{getFormattedNumber(item.factByDay)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByDay)"
                        >
                            {{getFormattedNumber(item.differenceByDay)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByDay)"
                        >
                            {{getFormattedNumber(item.differenceOpecByDay)}}
                        </td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByMonth)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByMonth)}}</td>
                        <td>{{getFormattedNumber(item.factByMonth)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByMonth)"
                        >
                            {{getFormattedNumber(item.differenceByMonth)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByMonth)"
                        >
                            {{getFormattedNumber(item.differenceOpecByMonth)}}
                        </td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByYear)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByYear)}}</td>
                        <td>{{getFormattedNumber(item.factByYear)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByYear)"
                        >
                            {{getFormattedNumber(item.differenceByYear)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByYear)"
                        >
                            {{getFormattedNumber(item.differenceOpecByYear)}}
                        </td>
                    </tr>
                    <tr
                            v-for="(item, index) in tableOutput.byDzo"
                            :class="getRowClass(index)"
                    >
                        <td v-if="index !== 1">{{item.number}}</td>
                        <td v-else></td>
                        <td
                                :class="index === 1 ? 'troubled-companies-padding' : ''"
                        >
                            {{companiesNameMapping.summaryByDzo[item.dzo]}}
                        </td>
                        <td >{{getFormattedNumber(item.yearlyPlan)}}</td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.monthlyPlan)}}</td>
                        <td v-else>{{getFormattedNumber(item.monthlyPlanOpec)}}</td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByDay)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByDay)}}</td>
                        <td>{{getFormattedNumber(item.factByDay)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByDay)"
                        >
                            {{getFormattedNumber(item.differenceByDay)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByDay)"
                        >
                            {{getFormattedNumber(item.differenceOpecByDay)}}
                        </td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByMonth)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByMonth)}}</td>
                        <td>{{getFormattedNumber(item.factByMonth)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByMonth)"
                        >
                            {{getFormattedNumber(item.differenceByMonth)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByMonth)"
                        >
                            {{getFormattedNumber(item.differenceOpecByMonth)}}
                        </td>

                        <td v-if="!isOpecActive">{{getFormattedNumber(item.planByYear)}}</td>
                        <td v-else>{{getFormattedNumber(item.planOpecByYear)}}</td>
                        <td>{{getFormattedNumber(item.factByYear)}}</td>
                        <td
                                v-if="!isOpecActive"
                                :class="getColorBy(item.differenceByYear)"
                        >
                            {{getFormattedNumber(item.differenceByYear)}}
                        </td>
                        <td
                                v-else
                                :class="getColorBy(item.differenceOpecByYear)"
                        >
                            {{getFormattedNumber(item.differenceOpecByYear)}}
                        </td>
                    </tr>
                </table>
                <table class="col-12" id="exportReport" style="display:none">
                    <tr>
                        <th colspan="13" style="font-family: arial; font-size: 16px; font-weight: bold; text-align: center">Оперативная суточная информация по добыче, сдаче нефти и газового конденсата АО НК "КазМунайГаз"</th>
                    </tr>
                    <tr style="font-family: Arial; font-size: 13px; font-style: italic;">
                        <th></th>
                        <th>по состоянию на:</th>
                        <th>{{currentDate}}</th>
                    </tr>
                    <tr style="font-family: Arial; font-size: 13px;">
                        <th style="border: 1px solid black" rowspan="3">№ п/п</th>
                        <th style="border: 1px solid black; width: 300px" rowspan="3">Предприятия</th>
                        <th style="border: 1px solid black" colspan="11" class="background-delimeters">ДОБЫЧА, тонн</th>
                    </tr>
                    <tr style="font-family: Arial; font-size: 13px;">
                        <th style="border: 1px solid black" rowspan="2">
                            План на {{currentYear}} г.
                        </th>
                        <th style="border: 1px solid black" rowspan="2">
                            План на <br>{{currentMonthName}} месяц
                        </th>
                        <th style="border: 1px solid black" colspan="3" class="background-delimeters">СУТОЧНАЯ</th> <!-- >суточная <-->
                        <th style="border: 1px solid black" colspan="3" class="background-delimeters">С НАЧАЛА МЕСЯЦА</th> <!-- >с начала месяца <-->
                        <th style="border: 1px solid black" colspan="3" class="background-delimeters">С НАЧАЛА ГОДА</th> <!-- >с начала года <-->
                    </tr>
                    <tr style="font-family: Arial; font-size: 13px;">
                        <th style="border: 1px solid black" >План</th>
                        <th style="border: 1px solid black" >Факт</th>
                        <th style="border: 1px solid black" >(+,-)</th>
                        <th style="border: 1px solid black" >План</th>
                        <th style="border: 1px solid black" >Факт</th>
                        <th style="border: 1px solid black" >(+,-)</th>
                        <th style="border: 1px solid black" >План</th>
                        <th style="border: 1px solid black" >Факт</th>
                        <th style="border: 1px solid black" >(+,-)</th>
                    </tr>
                    <tr
                            v-for="(item, index) in summaryForExport.byKMG"
                    >
                        <td v-if="index !== 3" :style="getStyleForSummary(index,true,'id')">{{item.number}}</td>
                        <td v-else></td>
                        <td v-if="[3,15,16,17].includes(index)" :style="getStyleForSummary(index,true,'name')">
                            &emsp;&emsp;{{companiesNameMapping.withParticipation[item.dzo]}}
                        </td>
                        <td v-else :style="getStyleForSummary(index,true,'name')"">
                            {{companiesNameMapping.withParticipation[item.dzo]}}
                        </td>
                        <td :style="getStyleForSummary(index,true)">{{getFormattedNumber(item.yearlyPlan)}}</td>
                        <td :style="getStyleForSummary(index,true)">{{getFormattedNumber(item.monthlyPlan)}}</td>
                        <td :style="getStyleForSummary(index,true)">{{getFormattedNumber(item.planByDay)}}</td>
                        <td :style="getStyleForSummary(index,true)">{{getFormattedNumber(item.factByDay)}}</td>
                        <td :style="getStyleByDifference(item.differenceByDay,index,true)">
                            {{getFormattedNumber(item.differenceByDay)}}
                        </td>
                        <td :style="getStyleForSummary(index,true)">{{getFormattedNumber(item.planByMonth)}}</td>
                        <td :style="getStyleForSummary(index,true)">{{getFormattedNumber(item.factByMonth)}}</td>
                        <td :style="getStyleByDifference(item.differenceByMonth,index,true)">
                            {{getFormattedNumber(item.differenceByMonth)}}
                        </td>
                        <td :style="getStyleForSummary(index,true)">{{getFormattedNumber(item.planByYear)}}</td>
                        <td :style="getStyleForSummary(index,true)">{{getFormattedNumber(item.factByYear)}}</td>
                        <td :style="getStyleByDifference(item.differenceByYear,index,true)">
                            {{getFormattedNumber(item.differenceByYear)}}
                        </td>
                    </tr>
                    <tr class="row-divider">
                    </tr>
                    <tr
                            v-for="(item, index) in summaryForExport.byDzo"
                    >
                        <td v-if="index !== 3" :style="getStyleForSummary(index,false,'id')">{{item.number}}</td>
                        <td v-else></td>
                        <td v-if="index === 3" :style="getStyleForSummary(index,false,'name')">
                            &emsp;&emsp;{{companiesNameMapping.summaryByDzo[item.dzo]}}
                        </td>
                        <td v-else :style="getStyleForSummary(index,false,'name')">
                            {{companiesNameMapping.summaryByDzo[item.dzo]}}
                        </td>
                        <td :style="getStyleForSummary(index,false)">{{getFormattedNumber(item.yearlyPlan)}}</td>
                        <td :style="getStyleForSummary(index,false)">{{getFormattedNumber(item.monthlyPlan)}}</td>
                        <td :style="getStyleForSummary(index,false)">{{getFormattedNumber(item.planByDay)}}</td>
                        <td :style="getStyleForSummary(index,false)">{{getFormattedNumber(item.factByDay)}}</td>
                        <td :style="getStyleByDifference(item.differenceByDay,index)">
                            {{getFormattedNumber(item.differenceByDay)}}
                        </td>
                        <td :style="getStyleForSummary(index,false)">{{getFormattedNumber(item.planByMonth)}}</td>
                        <td :style="getStyleForSummary(index,false)">{{getFormattedNumber(item.factByMonth)}}</td>
                        <td :style="getStyleByDifference(item.differenceByMonth,index)">
                            {{getFormattedNumber(item.differenceByMonth)}}
                        </td>
                        <td :style="getStyleForSummary(index,false)">{{getFormattedNumber(item.planByYear)}}</td>
                        <td :style="getStyleForSummary(index,false)">{{getFormattedNumber(item.factByYear)}}</td>
                        <td :style="getStyleByDifference(item.differenceByYear,index)">
                            {{getFormattedNumber(item.differenceByYear)}}
                        </td>
                    </tr>
                    <tr class="row-divider">
                    </tr>
                    <tr>
                        <th colspan="13" style="font-family: arial; font-size: 16px; font-weight: bold; text-align: center">Информация по предприятиям недостигших плановых показателей по добыче нефти (отклонения)</th>
                    </tr>
                    <tr class="row-divider">
                    </tr>
                    <tr>
                        <td style="text-align:center; background: #fde3ce; border: 1px solid black">№ п/п</td>
                        <td style="text-align:center; background: #fde3ce; border: 1px solid black">Предприятия</td>
                        <td style="text-align:center; background: #fde3ce; border: 1px solid black">Период</td>
                        <td colspan="10" style="text-align:center; background: #fde3ce; border: 1px solid black">Пояснения</td>
                    </tr>
                    <div v-for="item in reasons">
                        <tr>
                            <td rowspan="2" style="text-align:center; border: 1px solid black">{{item.id}}</td>
                            <td rowspan="2" style="border: 1px solid black">{{item.dzo}}</td>
                            <td style="text-align:center; border: 1px solid black">За сутки</td>
                            <td colspan="10" style="border: 1px solid black">{{item.daily}}</td>
                        </tr>
                        <tr>
                            <td style="text-align:center; border: 1px solid black">С начала года</td>
                            <td colspan="10" style="border: 1px solid black">{{item.yearly}}</td>
                        </tr>
                    </div>
                </table>
           </div>
       </div>
   </div>
</template>
<script src="./index.js"></script>

<style scoped lang="scss">
    .dzo-row_dark {
        background: #e6e6e6;
        color: black;
    }
    .dzo-row_light {
        background: white;
        color: black;
    }
    .troubled-companies-padding {
        padding-left: 2% !important;
    }
    .bounce-enter-active {
        animation: bounce-in .5s;
    }
    .bounce-leave-active {
        animation: bounce-in .5s reverse;
    }
    @keyframes bounce-in {
        0% {
            transform: scale(0);
        }
        50% {
            transform: scale(1.5);
        }
        100% {
            transform: scale(1);
        }
    }
    .img-play {
        background: url(/img/visualcenter3/play.png) no-repeat;
        height: 25px;
        width: 25px;
        position: absolute;
        left: 60px;
    }
    .img-pause {
        background: url(/img/visualcenter3/pause.png) no-repeat;
        height: 25px;
        width: 25px;
        position: absolute;
        left: 90px;
    }
    .reason-box {
        position: absolute;
        width: 400px;
        background: white;
        color: black;
        padding: 5px;
        border-radius: 10px;
        display: none;
    }
    .slide-fade-enter-active {
        transition: all .5s ease;
    }
    .slide-fade-leave-active {
        transition: all .8s cubic-bezier(1.0, 0.5, 0.8, 1.0);
    }
    .slide-fade-enter, .slide-fade-leave-to {
        transform: translateX(10px);
        opacity: 0;
    }
    .title-opec {
        background: #3366FF;
        border-radius: 10px;
        line-height: 24px;
        font-weight: 700;
        padding: 2px 5px;
    }
    .header {
        justify-content: center;
        display: flex;
    }
    .summary-header_text-align {
        text-align: right !important;
    }
    .empty-row {
        border-bottom: 21px solid #272953;
    }
    .row-divider {
        border-bottom: 20px solid white;
    }
    .img-download {
        background: url(/img/visualcenter3/download.png) no-repeat;
        height: 25px;
        width: 25px;
        position: absolute;
        right: 60px;
    }
    .header-title {
        font-style: normal;
        font-weight: bold;
        font-size: 20px;
        line-height: 24px;
    }
    .hide-block {
        display:none;
    }
   .color_green {
       color: #00b353;
   }
   .color_red {
       color: #E31E24;
   }
   .background-dark {
       background: #272953;
   }
   .background-delimeters {
       background: #3D4473;
   }
   .page-container {
       flex-wrap: wrap;
       margin: 0 !important;
   }
   .page-wrapper {
       font-family: HarmoniaSansProCyr-Regular, Harmonia-sans;
       position: relative;
       min-height: calc(100vh - 78px);
       background: #272953;
       color: white;
       text-align: center;
   }
   .main-table {
       table-layout: fixed;
       border-collapse: collapse;
       position: static;
       tr {
           &:nth-child(2) {
               th {
                   height: 40px;
                   width: 14%;
               }
           }
           &:nth-child(3), &:nth-child(4), &:nth-child(23) {
               background: #333975;
           }
       }
       tr:not(.special):hover {
           background: #D5E5F7;
           td {
               font-size: 20px;
           }
       }
       th {
           font-style: normal;
           font-weight: bold;
           font-size: 13px;
           background: #353EA1;
           width: 10%;
           border: 1px solid #272953;
           &:first-child {
               width: 2%;
           }
           &:nth-child(2) {
               width: 14%;
           }
           &:nth-child(3), &:nth-child(4), &:nth-child(5) {
               width: 3%;
           }
       }
       td {
           text-align: right;
           font-size: 15px;
           font-family: Bold;
           width: 10%;
           border-right: 1px solid #696e96;
           padding-right: 5px;
           &:first-child {
               width: 2%;
               text-align: center;
           }
           &:nth-child(2) {
               font-family: HarmoniaSansProCyr-Regular, Harmonia-sans;
               text-align: left;
               padding-left: 5px;
           }
           &:nth-child(3), &:nth-child(4), &:nth-child(5) {
               width: 5%;
           }
       }
   }
   @media (min-width: 1950px) {
       .page-wrapper {
           height: 920px;
       }
       .main-table {
           font-size: 15px;
       }
   }
</style>